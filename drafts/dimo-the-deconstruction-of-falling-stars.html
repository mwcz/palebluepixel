<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>    DiMo: The Deconstruction of Falling Stars
</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



    <!--[if gte IE 9]
    <style type="text/css">
        .gradient {
            filter: none;
        }
    </style>
    <![endif]-->

            <link href="http://palebluepixel.org/theme/css/styles.min.css?0c248b20" rel="stylesheet">

    <!-- JavaScript plugins (requires jQuery) -->
    <script src="http://palebluepixel.org/theme/js/jquery.min.js"></script>

        <link href="http://palebluepixel.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Pale Blue Pixel ATOM Feed"/>
        <link href="http://palebluepixel.org/feeds/rss.xml" type="application/atom+xml" rel="alternate"
              title="Pale Blue Pixel RSS Feed"/>


</head>
<body>
<div class="container">
    <nav class="pbp-navbar" role="navigation">
        
        <a href="/">
            <img class="pbp-logo" src="http://palebluepixel.org/theme/images/logo.svg" />
        </a>
    </nav>
</div>
<!-- /.navbar -->
<main role="main" class="container">
    <article>
        <header class="page-header">
            <h2>
                DiMo: The Deconstruction of Falling Stars
            </h2>
        </header>
        <div class="entry-content">
            <nav class="toc"></nav>
            <h1 id="players">Players</h1>
<p>Playres wave batons around and cool stuff happens!</p>
<h2 id="camera-input">camera input</h2>
<p>Camera input is analysed by OpenCV.</p>
<p>The visualization uses <a href="https://en.wikipedia.org/wiki/WebSocket">WebSockets</a> to connect to a Python server.  That
Python server, in turn, connects to a webcam and uses <a href="http://opencv.org/">OpenCV</a> to find
the locations of the red, green, and blue batons.  It then relays the
coordinates of each baton back to the visualization, which draws them on the
screen.</p>
<p>Near the end of the project, things were going well.  The gravity felt great,
player movements were smooth, 50,000 particles ran pretty smoothly on a common
laptop, and player recognition was perfect.  The one thing that was lacking is
it didn't <em>look</em> spectacular.  In essence, it looked cool, but only to geeks
who .</p>
<h2 id="movement-smoothing-low-pass">movement smoothing low-pass</h2>
<p>The movement was jerky, so I smoothed it.</p>
<h2 id="websockets-json">websockets &amp; json</h2>
<p>The Python server listens for incoming websocket connections.  When the DiMo
webpage is visited, it establishes a websockets connection with the server.
Then they trade places, and the webpage listens for messages from the server.</p>
<h1 id="particles">particles</h1>
<p>Particles swirl around and look cool.</p>
<h2 id="gravity">gravity</h2>
<p>Gravity has been written a few times.  First with inlined calculations, then
with ThreeJS vector objects, then with <a href="http://glmatrix.net/">glmatrix</a>, and then inlined again.
The inlined code performance wasn't distinguishable from the glmatrix
implementation.  Since the glmatrix API, although a little unconventional, is
excellent and much more readable, I stuck with it.</p>
<p>ThreeJS's vector calculations, on the other hand, were awful.  Each function
call created a new vector object.  Each acceleration calculation caused the
creation of 12 vector objects.</p>
<pre><code> 10,000 particles    *
    60 fps           *
    12 objects       *
     3 player pieces
---------------------------------
 21,600,000 new objects per second
</code></pre>
<p>Needless to say, the performance was terrible.  glmatrix's in-place vector
operations solved this, and due to the better readability, it won out over
inline calculations.</p>
<h2 id="coloring-methods">coloring methods</h2>
<h3 id="accel-and-velocity-based-sine-cycles-pictures-andor-videos">accel and velocity-based sine cycles [pictures and/or videos!]</h3>
<p>Trigonometry and web development aren't a pair usually seen together in public.</p>
<p>Originally, each particle in dimo was given a color of either red, green, or
blue, assigned randomly when the simulation started.</p>
<p><img alt="silhouettes of players playing dimo" src="http://palebluepixel.org/static/images/034/random-colors.png" /></p>
<p>This <em>isn't</em> one of those rare miracles where randomness is beautiful.</p>
<figure>
    <div class="math">
        x = \dfrac{2\pi \cdot \lvert\vec{v}\rvert \cdot \lvert\vec{a}\rvert}{a_{max}}
    </div>
    <div class="math">
        \red{R(x)} = \cos(x + 1.76714) + 1) / 2
    </div>
    <div class="math">
        \green{G(x)} = \cos(x + 3.92699) + 1) / 2
    </div>
    <div class="math">
        \blue{B(x)} = \cos(x + 5.89048) + 1) / 2
    </div>
</figure>

<p>The range of <code>cos</code> and <code>sin</code> are <code>-1..1</code>, but the color values I needed are
<code>0..1</code>.  The <code>+1</code> addition shifts the output into <code>0..2</code>, and the <code>/2</code> division
scales it down to <code>0..1</code>.</p>
<p>When graphed, they look like this.</p>
<p><img alt="Roughly evenly-spaced sine waves" src="{filename}/static/images/033/sine_waves.png" /></p>
<p>These functions provide a pleasing cycling between the three colors.  Here's
the result.</p>
<p><img alt="image of the swaths of color" src="http://palebluepixel.org/static/images/034/swath-colors.png" /></p>
<h3 id="shaders-glsl-essentials">shaders (glsl essentials)</h3>
<h1 id="application-concerns">application concerns</h1>
<h2 id="architecture-threejs-app-design-tendencies-and-how-to-overcome-them">architecture (threejs app design tendencies and how to overcome them)</h2>
<h1 id="configuration">configuration</h1>
<h2 id="datgui-and-presets-preset-screenshots">datgui and presets (preset screenshots)</h2>
<p><link rel="stylesheet" type="text/css" href="http://palebluepixel.org/static/js/033/katex/katex.min.css">
<script src="http://palebluepixel.org/static/js/033/katex/katex.min.js"></script>
<script>
function render_math() {
    katex.render(this.innerHTML, this);
}
$('.math').each(render_math);
</script></p>
        </div>

        <!-- /.entry-content -->
    </article>

</main>


<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://palebluepixel.org/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://palebluepixel.org/theme/js/respond.min.js"></script>
</body>
</html>