!function(){function a(a){var b=new a.PerspectiveCamera(27,window.innerWidth/window.innerHeight,5,9001);return b.position.z=1750,b}var b=["three","dimo/particles"];define(b,a)}(window),function(){function a(a,b,c,d,e,f,g,h,i){var j=new h.GUI({load:f});j.revert(1),a.CONFIG_PANEL_VISIBLE||setTimeout(function(){j.close()},500);var k=j.addFolder("Gravity");k.add(a,"MAX_ACCEL",0,2).step(.01).listen().name("max accel").onChange(i.partial(a.set_value,"MAX_ACCEL")),k.add(a,"CYCLE_ACCELERATION").onChange(function(a){a?g.start_timer():g.stop_timer()}).name("timed explosions"),k.add(a,"RANDOM_GRAVITY_VARIANCE",0,1).step(.01).name("grav variation").onChange(b.set_mass_variance);var l=j.addFolder("Players");l.add(c,"smoothing",0,.99).step(.01).name("input smoothing").onChange(c.set_smoothing),l.add(c,"size",0,256).name("player size").onChange(c.set_size),"mouse"===a.INPUT_TYPE&&(l.add(c,"activate_next_player").name("Spacebar toggles player"),document.body.onkeyup=function(a){32==a.keyCode&&c.activate_next_player()});var m=j.addFolder("Particles");m.add(b,"MAX_VEL",0,16).name("max velocity"),m.add(b,"MIN_ACCEL_DIST",0,200).name("ring size"),m.add(b,"size",1,64).name("particle size").onChange(b.set_size),m.addColor(e,"color0").onChange(b.set_color0),m.addColor(e,"color1").onChange(b.set_color1),m.addColor(e,"color2").onChange(b.set_color2);var n=j.addFolder("Info");return n.add({f:function(){window.open("http://twitter.com/mwcz")}},"f").name("@mwcz"),n.add({f:function(){window.open("https://github.com/geekspark-rh/dimo-renderer")}},"f").name("Source code"),k.open(),l.open(),m.open(),n.open(),j.remember(a),j.remember(c),j.remember(d),j.remember(b),j.remember(e),j}var b=["dimo/config","dimo/particles","dimo/players","dimo/gravity","dimo/particle_colors","dimo/presets","dimo/timer","datgui","underscore"];define(b,a)}(window),function(){function a(){var a={MAX_ACCEL:1,RANDOM_GRAVITY_VARIANCE:.2,G:-1e4,DISPLAY_STATS:!0,CONFIG_PANEL_VISIBLE:!0,INPUT_TYPE:["websockets","mouse"][1],CYCLE_ACCELERATION:!0};return a.set_value=function(b,c){a[b]=c},a}var b=[];define(b,a)}(window),function(){function a(a,b){var c,d,e,f,g,h,i,j,k,l={},m=a.vec2,n=a.vec2.create(),o=a.vec2.create(),p=a.vec2.create();l.accel=function(a,d,e,f,g){return m.set(n,a,d),m.set(o,e,f),c=Math.pow(m.distance(n,o),2),m.subtract(p,o,n),m.normalize(p,p),k=g/c,m.scale(p,p,Math.abs(k)<b.MAX_ACCEL?k:0),p};var q,r;return l.accel=function(a,l,m,n,o,p){e=n-l,f=o-m,q=Math.pow(e,2),r=Math.pow(f,2),c=q+r,d=Math.sqrt(c),g=e/d,h=f/d,k=p/c,Math.abs(k)>b.MAX_ACCEL&&(k=b.MAX_ACCEL*Math.abs(k)/k),i=g*k,j=h*k,a[0]=i,a[1]=j},l}var b=["glmatrix","dimo/config"];define(b,a)}(),function(){function a(a,b,c,d,e,f,g,h,i,j,k){function l(){e.add(f.system),e.add(g.system),q=new a.WebGLRenderer({precision:"lowp"}),q.setClearColor(0,1),q.setSize(r,s),document.body.appendChild(q.domElement),j.DISPLAY_STATS&&(p=new b,p.domElement.style.position="absolute",p.domElement.style.top="0px",document.body.appendChild(p.domElement)),k.start_timer(),window.addEventListener("resize",m,!1)}function m(){d.aspect=r/s,d.updateProjectionMatrix(),q.setSize(r,s)}function n(){requestAnimationFrame(n),o()}function o(){f.update(),g.update(),q.render(e,d)}{var p,q,r=h.WIDTH,s=h.HEIGHT;Date.now()}l(),setTimeout(n(),0)}var b=["three","stats","underscore","dimo/camera","dimo/scene","dimo/particles","dimo/players","dimo/viewport","dimo/config-panel","dimo/config","dimo/timer"];define(b,a)}(window),function(){function a(a){function b(a){h.push(a)}function c(){a.each(h,function(a){a(f)})}function d(a){f.x=a.clientX/window.innerWidth,f.y=a.clientY/window.innerHeight,c()}function e(){var b=a.throttle(d,g);document.addEventListener("mousemove",b)}var f={x:0,y:0},g=20,h=[];return{init:e,coords:f,add_callback:b}}var b=["underscore"];define(b,a)}(window),function(){function a(){return[0,0]}var b=[];define(b,a)}(window),function(){function a(a,b){var c={};return c.length=0,c.set_color=function(b,d){var e="color"+b;c[e]=(new a.Color).setRGB(d.r,d.g,d.b),c.length=Math.max(b+1,c.length)},c.set_color0=b.partial(c.set_color,0),c.set_color1=b.partial(c.set_color,1),c.set_color2=b.partial(c.set_color,2),c.set_color(0,(new a.Color).setRGB(1,0,0)),c.set_color(1,(new a.Color).setRGB(0,1,0)),c.set_color(2,(new a.Color).setRGB(0,.5,1)),c}var b=["three","underscore"];define(b,a)}(window),function(){function a(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){return b.G*Math.random()*a+b.G*(1-a)}var n={},o=0,p=1;n.MAX_VEL=4,n.count=25e3,n.size=8;var q=1.75,r=q/2;n.geometry=new a.BufferGeometry;var s={size:{type:"f",value:null},customColor:{type:"c",value:null},acceleration:{type:"v3",value:null},velocity:{type:"v3",value:null},accel_mag:{type:"v",value:null},vel_mag:{type:"v",value:null}};n.uniforms={color:{type:"c",value:new a.Color(16777215)},color0:{type:"c",value:f.color0},color1:{type:"c",value:f.color1},color2:{type:"c",value:f.color2},texture:{type:"t",value:a.ImageUtils.loadTexture("img/particle-wide-glow.png")},max_vel:{type:"f",value:n.MAX_VEL},max_accel:{type:"f",value:b.MAX_ACCEL},mouse:{type:"v2",value:new a.Vector2}},n.material=new a.ShaderMaterial({uniforms:n.uniforms,attributes:s,vertexShader:i,fragmentShader:j,blending:a.AdditiveBlending,depthTest:!1,transparent:!0}),n.positions=new Float32Array(3*n.count),n.colors=new Float32Array(3*n.count),n.velocities=new Float32Array(3*n.count),n.sizes=new Float32Array(n.count),n.mass=new Float32Array(n.count),n.accel_mag=new Float32Array(n.count),n.vel_mag=new Float32Array(n.count);for(var t,u=n.count-1;u>=0;u--)n.sizes[u]=n.size,n.positions[3*u+0]=(Math.random()*q-r)*c.WIDTH/1.5,n.positions[3*u+1]=(Math.random()*q-r)*c.HEIGHT/1.5,n.positions[3*u+2]=0,t=f["color"+u%f.length],n.colors[3*u+0]=t.r,n.colors[3*u+1]=t.g,n.colors[3*u+2]=t.b,n.mass[u]=m(b.RANDOM_GRAVITY_VARIANCE),n.velocities[3*u+0]=0,n.velocities[3*u+1]=0,n.velocities[3*u+2]=0;n.geometry.addAttribute("position",new a.BufferAttribute(n.positions,3)),n.geometry.addAttribute("customColor",new a.BufferAttribute(n.colors,3)),n.geometry.addAttribute("velocity",new a.BufferAttribute(n.velocities,3)),n.geometry.addAttribute("size",new a.BufferAttribute(n.sizes,1)),n.geometry.addAttribute("vel_mag",new a.BufferAttribute(n.vel_mag,1)),n.geometry.addAttribute("accel_mag",new a.BufferAttribute(n.accel_mag,1));var v=n.geometry.attributes.velocity.array,w=n.geometry.attributes.position.array;n.system=new a.PointCloud(n.geometry,n.material),n.system.sortParticles=!0;{var x=new Float32Array(2),y=new Float32Array(2),z=k.vec2.create();k.vec2.create()}n.MIN_ACCEL_DIST=44;var A,B,C,D=k.vec2.create();return n.update=function(){for(A=n.count-1;A>=0;A--){for(o=3*A,p=o+1,k.vec2.set(x,0,0),C=g.count-1;C>=0;C--)k.vec2.set(z,w[o]-g.positions[3*C],w[p]-g.positions[3*C+1]),e.accel(y,g.positions[3*C],g.positions[3*C+1],w[o],w[p],n.mass[A]),k.vec2.length(z)<n.MIN_ACCEL_DIST&&k.vec2.scale(y,y,-1),k.vec2.add(x,x,y);v[o]+=x[0],v[p]+=x[1],k.vec2.set(D,v[o],v[p]),B=k.vec2.length(D),B>n.MAX_VEL&&(k.vec2.scale(D,D,n.MAX_VEL/B),v[o]=D[0],v[p]=D[1]),n.vel_mag[A]=k.vec2.length(D),n.accel_mag[A]=k.vec2.length(x),w[o]+=v[o],w[p]+=v[p]}n.uniforms.mouse.value[0]=h.coords.x,n.uniforms.mouse.value[1]=h.coords.y,n.geometry.attributes.vel_mag.needsUpdate=!0,n.geometry.attributes.position.needsUpdate=!0},n.set_count=function(a){var b;for(b=n.colors.length-1;b>=a;b-=1)n.colors[b]=0;n.count=a,n.geometry.attributes.customColor.needsUpdate=!0},n.set_size=function(a){var b;for(b=n.sizes.length-1;b>=0;b-=1)n.sizes[b]=a;n.geometry.attributes.size.needsUpdate=!0},n.set_mass_variance=function(a){var b;for(b=n.mass.length-1;b>=0;b-=1)n.mass[b]=m(a)},n.set_color=function(b,c){var d="color"+b;n.uniforms[d].value=(new a.Color).setRGB(c.r,c.g,c.b)},n.set_color0=l.partial(n.set_color,0),n.set_color1=l.partial(n.set_color,1),n.set_color2=l.partial(n.set_color,2),n}var b=["three","dimo/config","dimo/viewport","dimo/origin","dimo/gravity","dimo/particle_colors","dimo/players","dimo/mouse","text!shaders/vertex.vert","text!shaders/particle.frag","glmatrix","underscore"];define(b,a)}(),function(){function a(a){return[(new a.Color).setRGB(1,0,0),(new a.Color).setRGB(0,1,0),(new a.Color).setRGB(0,.5,1)]}var b=["three"];define(b,a)}(window),function(){function a(a,b,c,d,e,f,g,h,i){function j(a){w=JSON.parse(a.data),C||(C=[w.w,w.h],D=[C[0]/2,C[1]/2]),w.player_names[0].x=1.75*(w.player_names[0].x-D[0])*r/C[0],w.player_names[0].y=1.75*(w.player_names[0].y-D[1])*s/C[1],w.player_names[1].x=1.75*(w.player_names[1].x-D[0])*r/C[0],w.player_names[1].y=1.75*(w.player_names[1].y-D[1])*s/C[1],w.player_names[2].x=1.75*(w.player_names[2].x-D[0])*r/C[0],w.player_names[2].y=1.75*(w.player_names[2].y-D[1])*s/C[1]}function k(a){E<v.length&&(w[v[E]].x=1.6*(-a.x*r*1+r/2),w[v[E]].y=1.6*(a.y*s*1-s/2))}function l(){f.init(),f.add_callback(k)}function m(){try{var a="127.0.0.1",b=new WebSocket("ws://"+a+":1337");b.onopen=function(){console.log("connection established"),b.onmessage=j}}catch(c){console.log("Failed to create websocket connection to dimo server."),console.error(c)}}function n(){switch(g.INPUT_TYPE){case"mouse":l();break;case"websockets":m()}}var o,p,q={},r=b.WIDTH,s=b.HEIGHT,t=0,u=1,v=["red","green","blue"],w={red:{x:0,y:0},green:{x:0,y:0},blue:{x:0,y:0}};q.count=1,q.size=256,q.FLIP_X=-1,q.FLIP_Y=-1;q.geometry=new a.BufferGeometry;var x={size:{type:"f",value:null},customColor:{type:"c",value:null},acceleration:{type:"v3",value:null}},y={color:{type:"c",value:new a.Color(16777215)},texture:{type:"t",value:a.ImageUtils.loadTexture("img/particle-wide-glow-big.png")}},z=new a.ShaderMaterial({uniforms:y,attributes:x,vertexShader:h,fragmentShader:i,blending:a.AdditiveBlending,depthTest:!1,transparent:!0});q.positions=new Float32Array(3*q.count),q.prevpos=new Float32Array(3*q.count),q.colors=new Float32Array(3*q.count),q.sizes=new Float32Array(q.count);for(var A,B=0;B<q.count;B++)q.sizes[B]=q.size,q.positions[3*B+0]=0,q.positions[3*B+1]=0,q.positions[3*B+2]=10,A=e[B%e.length],q.colors[3*B+0]=A.r,q.colors[3*B+1]=A.g,q.colors[3*B+2]=A.b;q.geometry.addAttribute("position",new a.BufferAttribute(q.positions,3)),q.geometry.addAttribute("customColor",new a.BufferAttribute(q.colors,3)),q.geometry.addAttribute("size",new a.BufferAttribute(q.sizes,1)),o=q.geometry.attributes.size.array,p=q.geometry.attributes.position.array,q.system=new a.PointCloud(q.geometry,z),q.system.sortParticles=!0;var C,D,E=0;q.activate_next_player=function(){E+=1,E%=q.count+1},n();var F;q.smoothing=.5;var G=q.smoothing,H=1-q.smoothing;return q.update=function(){for(F=q.count-1;F>=0;F--)t=3*F,u=t+1,p[t]=H*q.FLIP_X*w[v[F]].x+G*q.prevpos[t],p[u]=H*q.FLIP_Y*w[v[F]].y+G*q.prevpos[u],q.prevpos[t]=p[t],q.prevpos[u]=p[u];q.geometry.attributes.position.needsUpdate=!0},q.set_size=function(a){var b;for(b=q.sizes.length-1;b>=0;b-=1)q.sizes[b]=a;q.geometry.attributes.size.needsUpdate=!0},q.set_smoothing=function(a){G=a,H=1-a},q}var b=["three","dimo/viewport","dimo/origin","dimo/gravity","dimo/player_colors","dimo/mouse","dimo/config","text!shaders/vertex.vert","text!shaders/player.frag","glmatrix"];define(b,a)}(window),function(){function a(){return{preset:"RGB",closed:!1,remembered:{RGB:{0:{},1:{},2:{},3:{},4:{}},Fire:{0:{MAX_ACCEL:.06769734090000354,CYCLE_ACCELERATION:!0,RANDOM_GRAVITY_VARIANCE:1},1:{smoothing:.5,size:84.70101671549199},2:{},3:{MAX_VEL:1.5881440634154746,MIN_ACCEL_DIST:0,size:19.065138721351026},4:{color0:{r:1,g:0,b:0},color1:{r:1,g:0,b:0},color2:{r:1,g:.0588235294117645,b:0}}},Stars:{0:{MAX_ACCEL:.18,CYCLE_ACCELERATION:!1,RANDOM_GRAVITY_VARIANCE:.2},1:{smoothing:.5,size:158.10856453558503},2:{},3:{MAX_VEL:5.9996553506806825,MIN_ACCEL_DIST:44,size:5.168878166465621},4:{color0:{r:.9607843137254902,g:.9109166157812606,b:.8665897731641676},color1:{r:.8823529411764706,g:.8090779564420923,b:.5709342560553632},color2:{r:.8235294117647058,g:.6691770133659,b:.29873125720876587}}}},folders:{Gravity:{preset:"Default",closed:!1,folders:{}},Players:{preset:"Default",closed:!1,folders:{}},Particles:{preset:"Default",closed:!1,folders:{}},Info:{preset:"Default",closed:!1,folders:{}}}}}var b=[];define(b,a)}(window),requirejs.config({baseUrl:".",paths:{shaders:"shaders",text:"lib/requirejs/plugins/text",three:"lib/threejs/three",stats:"lib/threejs/stats.min",underscore:"lib/underscore/underscore",glmatrix:"lib/glMatrix/gl-matrix",datgui:"lib/dat.gui/dat.gui"},shim:{three:{exports:"THREE"},stats:{exports:"Stats",deps:["three"]},datgui:{exports:"dat"}},packages:[{name:"dimo",location:"js",main:"main.min"}]}),requirejs(["dimo"]),function(){function a(a){return new a.Scene}var b=["three"];define(b,a)}(window),function(){function a(a){var b,c,d={};return d.start_timer=function(){c=(new Date).getTime(),b=setInterval(function(){var b=Math.pow(((new Date).getTime()-c)/1e5,2);a.MAX_ACCEL+=b,a.MAX_ACCEL>2&&(c=(new Date).getTime()),a.MAX_ACCEL%=2},100)},d.stop_timer=function(){clearInterval(b)},d}var b=["dimo/config"];define(b,a)}(window),function(){function a(){return{WIDTH:window.innerWidth,HEIGHT:window.innerHeight}}define(a)}(window);