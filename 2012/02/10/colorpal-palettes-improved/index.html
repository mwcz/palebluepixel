<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>ColorPal palettes improved!</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Open Graph tags -->

            <meta property="og:type" content="article"/>
            <meta property="og:title" content="ColorPal palettes improved!"/>
            <meta property="og:url" content="http://beta.mwcz.org/2012/02/10/colorpal-palettes-improved/"/>
            <meta property="og:description" content="In my last post on the subject, I introduced ColorPal, my HTML5 color palette generation tool. It didn't perform well with certain types of images, so I fixed it. :) Color palettes will now match the image even ..."/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://beta.mwcz.org/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="http://beta.mwcz.org/theme/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://beta.mwcz.org/theme/css/pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="http://beta.mwcz.org/theme/css/style.css" type="text/css"/>
    <!-- JavaScript plugins (requires jQuery) -->
    <script src="http://code.jquery.com/jquery.js"></script>

        <link href="http://beta.mwcz.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="mwcz.org - a blog ATOM Feed"/>
        <link href="http://beta.mwcz.org/feeds/rss.xml" type="application/atom+xml" rel="alternate"
              title="mwcz.org - a blog RSS Feed"/>

</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://beta.mwcz.org" class="navbar-brand">mwcz.org - a blog</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li><a href="http://beta.mwcz.org/projects/">Projects</a></li>
                        <li class="active">
                            <a href="http://beta.mwcz.org/category/blog/">blog</a>
                        </li>
                        <li >
                            <a href="http://beta.mwcz.org/category/photos/">photos</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://beta.mwcz.org/archives/"><i class="icon-th-list"></i>Archives</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<!-- /.navbar -->
<div class="container">
    <div class="row">
        <div class="col-lg-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://beta.mwcz.org/2012/02/10/colorpal-palettes-improved/"
                       rel="bookmark"
                       title="Permalink to ColorPal palettes improved!">
                        ColorPal palettes improved!
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="icon-calendar"></i>Fri 10 February 2012
    </span>



<span class="label label-default">Tags</span>
	<a href="http://beta.mwcz.org/tag/html5/">html5</a>
        /
	<a href="http://beta.mwcz.org/tag/javascript/">javascript</a>
        /
	<a href="http://beta.mwcz.org/tag/color/">color</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><a href="/projects/colorpal"><static/images src="/static/images/019/colorpal_logo.png" alt="ColorPal logo" title=""
/></a></p>
<p>In my <a href="/2012/01/16/colorpal-alpha/">last post</a> on the subject, I introduced
ColorPal, my HTML5 color palette generation tool.  It didn't perform well with
certain types of images, so I fixed it. :)</p>
<p>Color palettes will now match the image even better.  Especially for images
with infrequent but <em>important</em> colors.  Here's a comparison of the old and new
methods, on an image that is mostly black:</p>
<p><img alt="comparison of palettes generated with median and
mean" src="/static/images/019/median-mean-comparison.png" /></p>
<p>You can see that with the old method, the black pixels definitely took over the
palette.</p>
<p><a href="/projects/colorpal">Try it with your own images!</a></p>
<p>For some images, this change won't affect palettes at all.  But for images with
low-population, high-importance colors, like the one above, palettes will look
<em>much</em> better!</p>
<p>Technical discussion below.</p>
<h1>Why the 'median' in median-cut?</h1>
<p>Median Cut is an algorithm typically used to reduce the number of colors in an
image.</p>
<p><img alt="16 million colors versus 16 colors" src="/static/images/019/median-cut-example.png" /></p>
<p>The steps to perform median cut are fairly straightforward:</p>
<ol>
<li>
<p>Find the smallest box which contains all the colors.</p>
</li>
<li>
<p>Sort the enclosed colors along the longest axis of the box.</p>
</li>
<li>
<p>Split the box into two regions at median of the sorted list.</p>
</li>
<li>
<p>Repeat the above process until the original color space has been divided
     into N regions where N is the number of colors you want.</p>
</li>
</ol>
<p>Not too bad, right?  The question remains, though, why median?</p>
<p>Mean, median, and mode all attempt to measure the
<a href="http://en.wikipedia.org/wiki/Location_parameter">location</a> of a probability
distribution.  Worded more intuitively... they try to find the center of a set
of numbers.  They just employ different definitions of "center".</p>
<p><img alt="mean, median, and mode graphed" src="/static/images/019/mean_median_mode.png" />
(Thanks <a href="http://en.wikipedia.org/wiki/Median">Wikipedia</a>)</p>
<p>As you can see clearly in the dashed data set, the mean tends to follow the
tail.  In other words, mean is useful when outliers are important.  When
generating a color palette, outliers are essential.  Outliers may be the small
streak of color in an otherwise drab sky, or a small red rose in the middle of
a green field.</p>
<p>The goal of median cut is <em>not</em> to generate a color palette.  It's to
efficiently reduce the number of colors in an image.  Since my goal with
ColorPal is to find good-lookin' colors, I've modified the algorithm to split
boxes at the <strong>mean</strong> instead of the <strong>median</strong>.  Mean splits boxes closer to
the outliers, which keeps low-population colors nicely segregated from the
high-population colors.</p>
<p>Thus step 3 becomes:</p>
<div class="pygments_murphy syntax_highlight">
  3. Split the box into two regions at the <b>mean</b> of the sorted list.
</div>

<p>The result?  Mean Cut!  Also: awesome color palettes.</p>
<h2>Interesting side-note on color distributions</h2>
<p>Interestingly, photographs of nature tend to have nice, close-to-normal color
distributions.  A "normal distribution" is a formal term for a "bell curve".</p>
<p>Check out the red, green, and blue distributions for a photograph of a forest.</p>
<p><img alt="Forest red   pixel distribution" src="/static/images/019/forest_r.png" />
<img alt="Forest green pixel distribution" src="/static/images/019/forest_g.png" />
<img alt="Forest blue  pixel distribution" src="/static/images/019/forest_b.png" /></p>
<p>For comparison, here are the distributions for a shot of NYC.</p>
<p><img alt="City   red   pixel distribution" src="/static/images/019/city_r.png" />
<img alt="City   green pixel distribution" src="/static/images/019/city_g.png" />
<img alt="City   blue  pixel distribution" src="/static/images/019/city_b.png" /></p>
<h2>What's next for ColorPal?  Color spaces.</h2>
<p>Mean-cut improves ColorPal dramatically for some images, but it's still not
perfect.  Perfection probably won't be attainable, but there are still many
ways to improve.</p>
<p>My next test will be converting to a color space other than RGB.</p>
<p>HSL is common, and the RGB/HSL conversion formulas are in my very old JSImage
project.  It may not turn out well, though, as the concept of "widest box"
loses most of its meaning when each axis is a completely different unit of
measure.  Although, in a way, I suppose RGB has a similar problem.  Red, Green,
and Blue could be thought of as unrelated units.  I'll try it out and see how
it goes.  I wonder if my old JavaScript RGB/HSL code has rotted away yet...</p>
<p>Most likely, I'll skip HSL and try one of the
<a href="http://en.wikipedia.org/wiki/Lab_color_space">Lab</a> color spaces first, since
they are not composed linear values like RGB and HSL.  Instead, Lab color
spaces use non-linear scales that closely match human perception of color.
Perfect for my purposes.  How fortuitious for me that CIE invented it way back
in 1931.</p>
<p>There are three "Lab" color spaces: XYZ, Hunter-Lab,
and CIELAB.  XYZ will be first to the plate, since the RGB/XYZ formulas are
the simplest.  Let me take this opportune moment to plug
<a href="http://www.easyrgb.com/index.php?X=MATH">EasyRGB.com</a>.</p>
<h2>Lend a hand</h2>
<p>As I've mentioned before, ColorPal is in an early stage of development.  It
needs testing in multiple browsers, and I'm very interested in hearing people's
feedback.  Code development help is welcomed too.</p>
<p>If you try out ColorPal, shoot me an <a href="mailto:mwc@clayto.org">email</a>
or give me a shout on <a href="https://twitter.com/#!/mwcz">Twitter</a> with your
thoughts.  Thanks!</p>
<p>Here are github repos for <a href="https://github.com/mwcz/ColorPal">ColorPal</a> and
<a href="https://github.com/mwcz/median-cut-js">median-cut.js</a>.</p>
            </div>
            <!-- /.entry-content -->
    <hr />
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'mwcz'; // required: replace example with your forum shortname
            var disqus_identifier = 'colorpal-palettes-improved';
            var disqus_url = 'http://beta.mwcz.org/2012/02/10/colorpal-palettes-improved/';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-lg-3 well well-sm" id="sidebar">
<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="icon-home icon-large"></i>Social</h4></li>
                    <li class="list-group-item"><a href="https://github.com/mwcz"><i
                            class="icon-GitHub-sign icon-large"></i>GitHub
                    </a></li>
                    <li class="list-group-item"><a href="https://twitter.com/mwcz"><i
                            class="icon-Twitter-sign icon-large"></i>Twitter
                    </a></li>



            <li class="list-group-item"><a href="http://beta.mwcz.org/tags.html"><h4><i class="icon-tags icon-large"></i>Tags</h4></a></li>
                <li class="list-group-item tag-0">
                    <a href="http://beta.mwcz.org/tag/html5/">
                        html5
                    </a>
                </li>
                <li class="list-group-item tag-1">
                    <a href="http://beta.mwcz.org/tag/canvas/">
                        canvas
                    </a>
                </li>
                <li class="list-group-item tag-1">
                    <a href="http://beta.mwcz.org/tag/javascript/">
                        javascript
                    </a>
                </li>
                <li class="list-group-item tag-1">
                    <a href="http://beta.mwcz.org/tag/color/">
                        color
                    </a>
                </li>
                <li class="list-group-item tag-2">
                    <a href="http://beta.mwcz.org/tag/amiga/">
                        amiga
                    </a>
                </li>
                <li class="list-group-item tag-2">
                    <a href="http://beta.mwcz.org/tag/jsimage/">
                        jsimage
                    </a>
                </li>
                <li class="list-group-item tag-2">
                    <a href="http://beta.mwcz.org/tag/aejs/">
                        aejs
                    </a>
                </li>
                <li class="list-group-item tag-2">
                    <a href="http://beta.mwcz.org/tag/colorpal/">
                        colorpal
                    </a>
                </li>
                <li class="list-group-item tag-3">
                    <a href="http://beta.mwcz.org/tag/physics/">
                        physics
                    </a>
                </li>
                <li class="list-group-item tag-3">
                    <a href="http://beta.mwcz.org/tag/bouncey/">
                        bouncey
                    </a>
                </li>
                <li class="list-group-item tag-3">
                    <a href="http://beta.mwcz.org/tag/general/">
                        general
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/stackoverflow/">
                        stackoverflow
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/vim/">
                        vim
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/linux/">
                        linux
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/bash/">
                        bash
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/bootstrap/">
                        bootstrap
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/n9/">
                        n9
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/typography/">
                        typography
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/python/">
                        python
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/test/">
                        test
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/image-processing/">
                        image processing
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/git/">
                        git
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/testing/">
                        testing
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/css3/">
                        css3
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/mwczorg/">
                        mwcz.org
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/django/">
                        django
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/keepass/">
                        keepass
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://beta.mwcz.org/tag/photo/">
                        photo
                    </a>
                </li>
        </ul>
    </section>


    <section>
    <ul class="list-group list-group-flush">
    <li class="list-group-item"><h4><i class="icon-github icon-large"></i>GitHub Repos</h4></li>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
    </ul>
        <script type="text/javascript">
            $(document).ready(function () {
                if (!window.jXHR) {
                    var jxhr = document.createElement('script');
                    jxhr.type = 'text/javascript';
                    jxhr.src = 'http://beta.mwcz.org/theme/js/jXHR.js';
                    var s = document.getElementsByTagName('script')[0];
                    s.parentNode.insertBefore(jxhr, s);
                }

                github.showRepos({
                    user: 'mwcz',
                    count: 5,
                    skip_forks: true,
                    target: '#gh_repos'
                });
            });
        </script>
        <script src="http://beta.mwcz.org/theme/js/github.js" type="text/javascript"></script>
    </section>
</aside>        </div>
    </div>
</div>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://beta.mwcz.org/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://beta.mwcz.org/theme/js/respond.min.js"></script>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'mwcz'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
</body>
</html>