!function(){function a(a){var b=new a.PerspectiveCamera(27,window.innerWidth/window.innerHeight,5,9001);return b.position.z=2750,b}var b=["three"];define(b,a)}(window),function(){function a(a,b,c,d,e,f,g,h,i){var j=new h.GUI({load:f});j.revert(1),a.CONFIG_PANEL_VISIBLE||setTimeout(function(){j.close()},500);var k=j.addFolder("Gravity");k.add(a,"MAX_ACCEL",0,2).step(.01).listen().onChange(i.partial(a.set_value,"MAX_ACCEL")),k.add(a,"CYCLE_ACCELERATION").onChange(function(a){a?g.start_timer():g.stop_timer()}),k.add(a,"RANDOM_GRAVITY_VARIANCE",0,1).step(.01).onChange(b.set_mass_variance);var l=j.addFolder("players");l.add(c,"smoothing",0,1).step(.1).onChange(c.set_smoothing),l.add(c,"size",0,256).onChange(c.set_size);var m=j.addFolder("Particles");return m.add(b,"MAX_VEL",0,16),m.add(b,"MIN_ACCEL_DIST",0,200),m.add(b,"size",1,64).onChange(b.set_size),m.addColor(e,"color0").onChange(b.set_color0),m.addColor(e,"color1").onChange(b.set_color1),m.addColor(e,"color2").onChange(b.set_color2),k.open(),l.open(),m.open(),j.remember(a),j.remember(c),j.remember(d),j.remember(b),j.remember(e),j}var b=["dimo/config","dimo/particles","dimo/players","dimo/gravity","dimo/particle_colors","dimo/presets","dimo/timer","datgui","underscore"];define(b,a)}(window),function(){function a(){var a={MAX_ACCEL:1,RANDOM_GRAVITY_VARIANCE:.2,G:-9810,DISPLAY_STATS:!0,CONFIG_PANEL_VISIBLE:!0,INPUT_TYPE:["websockets","mouse"][1],CYCLE_ACCELERATION:!0};return a.set_value=function(b,c){a[b]=c},a}var b=[];define(b,a)}(window),function(){function a(a,b){var c,d,e={},f=a.vec2,g=a.vec2.create(),h=a.vec2.create(),i=a.vec2.create();e.accel=function(a,e,j,k,l){return f.set(g,a,e),f.set(h,j,k),c=Math.pow(f.distance(g,h),2),f.subtract(i,h,g),f.normalize(i,i),d=l*b.G/c,f.scale(i,i,Math.abs(d)<b.MAX_ACCEL?d:0),i};return e}var b=["glmatrix","dimo/config"];define(b,a)}(),function(){function a(a,b,c,d,e,f,g,h,i,j,k){function l(){r=new a.Vector3(0,0,0),r.mass=30,e.add(f.system),e.add(g.system),q=new a.WebGLRenderer({precision:"lowp"}),q.setClearColor(0,1),q.setSize(u,v),document.body.appendChild(q.domElement),j.DISPLAY_STATS&&(p=new b,p.domElement.style.position="absolute",p.domElement.style.top="0px",document.body.appendChild(p.domElement)),k.start_timer(),window.addEventListener("resize",m,!1)}function m(){d.aspect=u/v,d.updateProjectionMatrix(),q.setSize(u,v)}function n(){requestAnimationFrame(n),s=Date.now(),t=s-x,t>y&&(x=s-t%y,o(),j.DISPLAY_STATS&&p.update())}function o(){f.update(),g.update(),q.render(e,d)}var p,q,r,s,t,u=h.WIDTH,v=h.HEIGHT,w=60,x=Date.now(),y=1e3/w;l(),setTimeout(n(),0)}var b=["three","stats","underscore","dimo/camera","dimo/scene","dimo/particles","dimo/players","dimo/viewport","dimo/config-panel","dimo/config","dimo/timer"];define(b,a)}(window),function(){function a(a){function b(a){h.push(a)}function c(){a.each(h,function(a){a(f)})}function d(a){f.x=a.clientX/window.innerWidth,f.y=a.clientY/window.innerHeight,c()}function e(){var b=a.throttle(d,g);document.addEventListener("mousemove",b)}var f={x:0,y:0},g=20,h=[];return{init:e,coords:f,add_callback:b}}var b=["underscore"];define(b,a)}(window),function(){function a(){return[0,0]}var b=[];define(b,a)}(window),function(){function a(a,b){var c={};return c.length=0,c.set_color=function(b,d){var e="color"+b;c[e]=(new a.Color).setRGB(d.r,d.g,d.b),c.length=Math.max(b+1,c.length)},c.set_color0=b.partial(c.set_color,0),c.set_color1=b.partial(c.set_color,1),c.set_color2=b.partial(c.set_color,2),c.set_color(0,(new a.Color).setRGB(1,0,0)),c.set_color(1,(new a.Color).setRGB(0,1,0)),c.set_color(2,(new a.Color).setRGB(0,.5,1)),c}var b=["three","underscore"];define(b,a)}(window),function(){function a(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){return Math.random()*a+(1-a)}var n={},o=0,p=1;n.MAX_VEL=4,n.count=2e4,n.size=16;var q=1.75,r=q/2;n.geometry=new a.BufferGeometry;var s={size:{type:"f",value:null},customColor:{type:"c",value:null},acceleration:{type:"v3",value:null},velocity:{type:"v3",value:null},accel_mag:{type:"v",value:null},vel_mag:{type:"v",value:null}};n.uniforms={color:{type:"c",value:new a.Color(16777215)},color0:{type:"c",value:f.color0},color1:{type:"c",value:f.color1},color2:{type:"c",value:f.color2},texture:{type:"t",value:a.ImageUtils.loadTexture("img/particle-wide-glow.png")},max_vel:{type:"f",value:n.MAX_VEL},max_accel:{type:"f",value:b.MAX_ACCEL},mouse:{type:"v2",value:new a.Vector2}},n.material=new a.ShaderMaterial({uniforms:n.uniforms,attributes:s,vertexShader:i,fragmentShader:j,blending:a.AdditiveBlending,depthTest:!1,transparent:!0}),n.positions=new Float32Array(3*n.count),n.colors=new Float32Array(3*n.count),n.velocities=new Float32Array(3*n.count),n.sizes=new Float32Array(n.count),n.mass=new Float32Array(n.count),n.accel_mag=new Float32Array(n.count),n.vel_mag=new Float32Array(n.count);for(var t,u=n.count-1;u>=0;u--)n.sizes[u]=n.size,n.positions[3*u+0]=(Math.random()*q-r)*c.WIDTH*1,n.positions[3*u+1]=(Math.random()*q-r)*c.HEIGHT*1,n.positions[3*u+2]=0,t=f["color"+u%f.length],n.colors[3*u+0]=t.r,n.colors[3*u+1]=t.g,n.colors[3*u+2]=t.b,n.mass[u]=m(b.RANDOM_GRAVITY_VARIANCE),n.velocities[3*u+0]=n.positions[3*u+0]/c.WIDTH,n.velocities[3*u+1]=n.positions[3*u+1]/c.HEIGHT,n.velocities[3*u+2]=0;n.geometry.addAttribute("position",new a.BufferAttribute(n.positions,3)),n.geometry.addAttribute("customColor",new a.BufferAttribute(n.colors,3)),n.geometry.addAttribute("velocity",new a.BufferAttribute(n.velocities,3)),n.geometry.addAttribute("size",new a.BufferAttribute(n.sizes,1)),n.geometry.addAttribute("vel_mag",new a.BufferAttribute(n.vel_mag,1)),n.geometry.addAttribute("accel_mag",new a.BufferAttribute(n.accel_mag,1));var v=n.geometry.attributes.velocity.array,w=n.geometry.attributes.position.array;n.system=new a.PointCloud(n.geometry,n.material),n.system.sortParticles=!0;var x,y=new Float32Array(2),z=k.vec2.create();n.MIN_ACCEL_DIST=44;var A,B,C=k.vec2.create();return n.update=function(){for(A=n.count-1;A>=0;A--)o=3*A,p=o+1,k.vec2.set(y,0,0),k.vec2.set(z,w[o]-g.positions[0],w[p]-g.positions[1]),x=e.accel(g.positions[0],g.positions[1],w[o],w[p],n.mass[A]),k.vec2.length(z)<n.MIN_ACCEL_DIST&&k.vec2.scale(x,x,-1),k.vec2.add(y,y,x),k.vec2.set(z,w[o]-g.positions[3],w[p]-g.positions[4]),x=e.accel(g.positions[3],g.positions[4],w[o],w[p],n.mass[A]),k.vec2.length(z)<n.MIN_ACCEL_DIST&&k.vec2.scale(x,x,-1),k.vec2.add(y,y,x),k.vec2.set(z,w[o]-g.positions[6],w[p]-g.positions[7]),x=e.accel(g.positions[6],g.positions[7],w[o],w[p],n.mass[A]),k.vec2.length(z)<n.MIN_ACCEL_DIST&&k.vec2.scale(x,x,-1),k.vec2.add(y,y,x),v[o]+=y[0],v[p]+=y[1],k.vec2.set(C,v[o],v[p]),B=k.vec2.length(C),B>n.MAX_VEL&&(k.vec2.scale(C,C,n.MAX_VEL/B),v[o]=C[0],v[p]=C[1]),n.vel_mag[A]=k.vec2.length(C),n.accel_mag[A]=k.vec2.length(y),w[o]+=v[o],w[p]+=v[p];n.uniforms.mouse.value=new a.Vector2(h.coords.x,h.coords.y),n.geometry.attributes.vel_mag.needsUpdate=!0,n.geometry.attributes.accel_mag.needsUpdate=!0,n.geometry.attributes.position.needsUpdate=!0,n.geometry.attributes.velocity.needsUpdate=!0},n.set_count=function(a){var b;for(b=n.colors.length-1;b>=a;b-=1)n.colors[b]=0;n.count=a,n.geometry.attributes.customColor.needsUpdate=!0},n.set_size=function(a){var b;for(b=n.sizes.length-1;b>=0;b-=1)n.sizes[b]=a;n.geometry.attributes.size.needsUpdate=!0},n.set_mass_variance=function(a){var b;for(b=n.mass.length-1;b>=0;b-=1)n.mass[b]=m(a)},n.set_color=function(b,c){var d="color"+b;n.uniforms[d].value=(new a.Color).setRGB(c.r,c.g,c.b)},n.set_color0=l.partial(n.set_color,0),n.set_color1=l.partial(n.set_color,1),n.set_color2=l.partial(n.set_color,2),n}var b=["three","dimo/config","dimo/viewport","dimo/origin","dimo/gravity","dimo/particle_colors","dimo/players","dimo/mouse","text!shaders/vertex.vert","text!shaders/particle.frag","glmatrix","underscore"];define(b,a)}(),function(){function a(a){return[(new a.Color).setRGB(1,0,0),(new a.Color).setRGB(0,1,0),(new a.Color).setRGB(0,.5,1)]}var b=["three"];define(b,a)}(window),function(){function a(a,b,c,d,e,f,g,h,i){function j(a){v=JSON.parse(a.data),D||(D=[v.w,v.h],E=[D[0]/2,D[1]/2]),v.red.x=1.75*(v.red.x-E[0])*r/D[0],v.red.y=1.75*(v.red.y-E[1])*s/D[1],v.green.x=1.75*(v.green.x-E[0])*r/D[0],v.green.y=1.75*(v.green.y-E[1])*s/D[1],v.blue.x=1.75*(v.blue.x-E[0])*r/D[0],v.blue.y=1.75*(v.blue.y-E[1])*s/D[1]}function k(a){v.red.x=1.3*(-a.x*r*1+r/2),v.green.x=1.3*(-a.x*r*1+r/2),v.blue.x=1.3*(-a.x*r*1+r/2),v.red.y=1.3*(a.y*s*1-s/2),v.green.y=1.3*(a.y*s*1-s/2),v.blue.y=1.3*(a.y*s*1-s/2)}function l(){f.init(),f.add_callback(k)}function m(){try{var a="127.0.0.1",b=new WebSocket("ws://"+a+":1337");b.onopen=function(){console.log("connection established"),b.onmessage=j}}catch(c){console.log("Failed to create websocket connection to dimo server."),console.error(c)}}function n(){switch(g.INPUT_TYPE){case"mouse":l();break;case"websockets":m()}}var o,p,q={},r=b.WIDTH,s=b.HEIGHT,t=0,u=1,v={red:{x:0,y:0},green:{x:0,y:0},blue:{x:0,y:0}};q.count=3,q.size=256,q.FLIP_X=-1,q.FLIP_Y=-1;var w=.5,x=w/2;q.geometry=new a.BufferGeometry;var y={size:{type:"f",value:null},customColor:{type:"c",value:null},acceleration:{type:"v3",value:null}},z={color:{type:"c",value:new a.Color(16777215)},texture:{type:"t",value:a.ImageUtils.loadTexture("img/particle-wide-glow-big.png")}},A=new a.ShaderMaterial({uniforms:z,attributes:y,vertexShader:h,fragmentShader:i,blending:a.AdditiveBlending,depthTest:!1,transparent:!0});q.positions=new Float32Array(3*q.count),q.prevpos=new Float32Array(3*q.count),q.colors=new Float32Array(3*q.count),q.sizes=new Float32Array(q.count);for(var B,C=0;C<q.count;C++)q.sizes[C]=q.size,q.positions[3*C+0]=(Math.random()*w-x)*r,q.positions[3*C+1]=(Math.random()*w-x)*s,q.positions[3*C+2]=10,B=e[C%e.length],q.colors[3*C+0]=B.r,q.colors[3*C+1]=B.g,q.colors[3*C+2]=B.b;q.geometry.addAttribute("position",new a.BufferAttribute(q.positions,3)),q.geometry.addAttribute("customColor",new a.BufferAttribute(q.colors,3)),q.geometry.addAttribute("size",new a.BufferAttribute(q.sizes,1)),o=q.geometry.attributes.size.array,p=q.geometry.attributes.position.array,q.system=new a.PointCloud(q.geometry,A),q.system.sortParticles=!0;var D,E;n();var F,G=["red","green","blue"];q.smoothing=.5;var H=q.smoothing,I=1-q.smoothing;return q.update=function(){for(F=q.count-1;F>=0;F--)t=3*F,u=t+1,p[t]=I*q.FLIP_X*v[G[F]].x+H*q.prevpos[t],p[u]=I*q.FLIP_Y*v[G[F]].y+H*q.prevpos[u],q.prevpos[t]=p[t],q.prevpos[u]=p[u];q.geometry.attributes.position.needsUpdate=!0},q.set_size=function(a){var b;for(b=q.sizes.length-1;b>=0;b-=1)q.sizes[b]=a;q.geometry.attributes.size.needsUpdate=!0},q.set_smoothing=function(a){H=a,I=1-a},q}var b=["three","dimo/viewport","dimo/origin","dimo/gravity","dimo/player_colors","dimo/mouse","dimo/config","text!shaders/vertex.vert","text!shaders/player.frag","glmatrix"];define(b,a)}(window),function(){function a(){return{preset:"RGB",closed:!1,remembered:{Default:{0:{},1:{}},Fire:{0:{},1:{MAX_VEL:4,MIN_ACCEL_DIST:44,size:16},2:{color0:{r:1,g:.9999999999999998,b:0},color1:{r:1,g:.5294117647058825,b:0},color2:{r:1,g:0,b:0}}},RGB:{0:{MAX_ACCEL:1.5,CYCLE_ACCELERATION:!1,RANDOM_GRAVITY_VARIANCE:0},1:{smoothing:.4,size:42.350508357745994},2:{},3:{MAX_VEL:10.940547992417715,MIN_ACCEL_DIST:0,size:16},4:{color0:{r:1,g:0,b:0},color1:{r:0,g:1,b:0},color2:{r:0,g:.5,b:1}}},Stars:{0:{},1:{MAX_VEL:2.9998276753403412,MIN_ACCEL_DIST:28.67482336722385,size:16},2:{color0:{r:.9509803921568627,g:.9509803921568627,b:.8204536716647444},color1:{r:.9117647058823529,g:.9001967569034534,b:.7151095732410611},color2:{r:.9117647058823529,g:.8686478051428185,b:.5452710495963091}}},FAST:{0:{MAX_ACCEL:1.5,CYCLE_ACCELERATION:!1,RANDOM_GRAVITY_VARIANCE:0},1:{smoothing:.4,size:42.350508357745994},2:{},3:{MAX_VEL:10.940547992417715,MIN_ACCEL_DIST:0,size:16},4:{color0:{r:1,g:0,b:0},color1:{r:0,g:1,b:0},color2:{r:0,g:.5,b:1}}}},folders:{Gravity:{preset:"Default",closed:!1,folders:{}},players:{preset:"Default",closed:!1,folders:{}},Particles:{preset:"Default",closed:!1,folders:{}}}}}var b=[];define(b,a)}(window),requirejs.config({baseUrl:".",paths:{shaders:"shaders",text:"lib/requirejs/plugins/text",three:"lib/threejs/three",stats:"lib/threejs/stats.min",underscore:"lib/underscore/underscore",glmatrix:"lib/glMatrix/gl-matrix",datgui:"lib/dat.gui/dat.gui"},shim:{three:{exports:"THREE"},stats:{exports:"Stats",deps:["three"]},datgui:{exports:"dat"}},packages:[{name:"dimo",location:"js",main:"main.min"}]}),requirejs(["dimo"]),function(){function a(a){return new a.Scene}var b=["three"];define(b,a)}(window),function(){function a(a){var b,c,d={};return d.start_timer=function(){c=(new Date).getTime(),b=setInterval(function(){var b=Math.pow(((new Date).getTime()-c)/1e5,2);a.MAX_ACCEL+=b,a.MAX_ACCEL>2&&(c=(new Date).getTime()),a.MAX_ACCEL%=2},100)},d.stop_timer=function(){clearInterval(b)},d}var b=["dimo/config"];define(b,a)}(window),function(){function a(){return{WIDTH:window.innerWidth,HEIGHT:window.innerHeight}}define(a)}(window);